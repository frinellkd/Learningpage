{% extends 'base.html' %}
{% block body %} 
<body>
   

<h1>Learning Page</h1>
<!-- html div for timeline: -->
   

<h2>Topics</h2>
    <div id='mytimeline'></div>
    
    <div id='map-canvas' class='map-canvas' >Map should go here!</div>

    
   <!--Begin script for map -->
    <script>

//Create the variables that will be used within the map configuration options.
//The latitude and longitude of the center of the map.
var mainMapCenter = new google.maps.LatLng(32.4621474,-92.8396034);
//The degree to which the map is zoomed in. This can range from 0 (least zoomed) to 21 and above (most zoomed).
var mainMapZoom = 3;
// The max and min zoom levels that are allowed.
var mainMapZoomMax = 5;
var mainMapZoomMin = 3;

//These options configure the setup of the map. 
var mainMapOptions = { 
          center: mainMapCenter, 
          zoom: mainMapZoom,
          //The type of map. In addition to ROADMAP, the other 'premade' map styles are SATELLITE, TERRAIN and HYBRID. 
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          maxZoom: mainMapZoomMax,
          minZoom: mainMapZoomMin,
          //Turn off the map controls as we will be adding our own later.
          panControl: false,
          mapTypeControl: false,
};

//Create the variable for the main map itself.
var mainMap;

//THE MAIN FUNCTION THAT IS CALLED WHEN THE WEB PAGE LOADS--------------------------------------------------------------------------------
    function loadmainMap(){

        mainmap = new google.maps.Map(
            document.getElementById('map-canvas'),
            mainMapOptions);

    //Calls the function below to load up all the map markers.
    loadMapMarkers();

    };    
    
    

    function loadMapMarkers (){    
        {% for data in topic_data %}

        var infowindow{{data.topic_id}} = new google.maps.InfoWindow({
            content: '{{data.description}}<a href="/view/{{data.topic_id}}">Go to Page</a>'
            });
        
        // attach markers to each topic locaiton retruned in JSON
            var marker{{data.topic_id}} = new google.maps.Marker({
                    map: mainmap,
                    title: '{{ data.topic_title}}',
                    label: '{{data.topic_id}}',
                    place: { 
                        location: {lat: {{data.center_lat}}, lng: {{data.center_lng}}},
                        query: '{{data.description}}'
                    }
                        
            });        
            
            marker{{data.topic_id}}.addListener('click', function(){
            infowindow{{data.topic_id}}.open(mainmap, marker{{data.topic_id}});    
            });

            marker{{data.topic_id}}.addListener('click', function(){
            infowindow{{data.topic_id}}.open(map, marker{{data.topic_id}});
                
            });

        {% endfor %} 
    }

    google.maps.event.addDomListener(window, 'load', loadmainMap);

    </script>
    <!--End script for map-->

    <!--Begin script for Timeline-->
    <script>
        google.load("visualization", "1");
        google.setOnLoadCallback(drawTimeline);
        function drawTimeline() {
        // Create and populate a data table.
        var data = new google.visualization.DataTable();
        data.addColumn('datetime', 'start');
        data.addColumn('datetime', 'end');
        data.addColumn('string', 'content');

        var d, date_list, year, month, day


        {% for data in topic_data %}

        d = '{{data.main_date}}';
        date_list= d.split('-') ;


        year = date_list[0];
        month = date_list[1];
        day = date_list[2];
        
        
        data.addRows([
          [new Date(year, month, day), , '{{data.topic_title}}<br>'+'<img src="{{data.image}}"  style="width:48px; height:48px;"><a href="/view/{{data.topic_id}}">Go to Page</a>'],
         
        ]);

        {% endfor %} 
        // specify options
        var options = {
          "width":  "100%",
          "height": "200px",
          "style": "box" // optional
        };

        // Instantiate our timeline object.
        var timeline = new links.Timeline(document.getElementById('mytimeline'));

        // Draw our timeline with the created data and options
        timeline.draw(data, options);
        


        }

        


    </script>
    <!--End script for timeline-->
        
</body>
</html>
   
{% endblock %}
